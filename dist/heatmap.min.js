!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(t=t||self).heatmap=o()}(this,(function(){"use strict";var t="\n                    precision mediump float; uniform float u_max; uniform float u_blurr;\n                    varying float v_i;\n                    void main() {\n                        float r = 0.0; vec2 cxy = 2.0 * gl_PointCoord - 1.0; r = dot(cxy, cxy);\n                        if(r > 1.0) { discard; } else { gl_FragColor = vec4(0, 0, 0, (v_i/u_max) * (u_blurr) * (1.0 - sqrt(r))); }\n                    }\n            ",o="\n\t\t\t\tattribute vec2 a_position; attribute float a_intensity; uniform float u_size; uniform vec2 u_resolution; uniform vec2 u_translate; uniform float u_zoom; uniform float u_angle; uniform float u_density;\n\t\t\t\tvarying float v_i;\n\n\t\t\t\tvec2 rotation(vec2 v, float a) {\n\t\t\t\t\tfloat s = sin(a); float c = cos(a); mat2 m = mat2(c, -s, s, c); \n\t\t\t\t\treturn m * v;\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 zeroToOne = (a_position * u_density + u_translate * u_density) / (u_resolution);\n\t\t\t\t\tvec2 zeroToTwo = zeroToOne * 2.0 - 1.0;\n\t\t\t\t\tzeroToTwo = zeroToTwo * u_zoom;\n\t\t\t\t\tzeroToTwo = rotation(zeroToTwo, u_angle);\n\t\t\t\t\tgl_Position = vec4(zeroToTwo , 0, 1);\n\t\t\t\t\tgl_PointSize = u_size * u_density;\n\t\t\t\t\tv_i = a_intensity;\n\t\t\t\t}\n\t\t\t",r="\n\t\t\t\t\t\tprecision mediump float;\n\t\t\t\t\t\tvarying vec2 v_texCoord;\n\t\t\t\t\t\tuniform sampler2D u_framebuffer; uniform vec4 u_colorArr[100]; uniform float u_colorCount; uniform float u_opacity; uniform float u_offset[100];\n\n\t\t\t\t\t\tfloat remap ( float minval, float maxval, float curval ) {\n\t\t\t\t\t\t\treturn ( curval - minval ) / ( maxval - minval );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvoid main() {\n\t\t\t\t\t\t\tvec4 color = vec4(texture2D(u_framebuffer, v_texCoord.xy));\n\t\t\t\t\t\t\tif (color.a == 0.0) {\n\t\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvec4 color_;\n\t\t\t\t\t\t\t\tfloat fract = 1.0 / (u_colorCount - 1.0);\n\t\t\t\t\t\t\t\tif (color.a <= u_offset[1]) {\n\t\t\t\t\t\t\t\t\tcolor_ = mix( u_colorArr[0], u_colorArr[1], remap( u_offset[0], u_offset[1], color.a ) );\n\t\t\t\t\t\t\t\t} else if (color.a <= u_offset[2]) {\n\t\t\t\t\t\t\t\t\tcolor_ = mix( u_colorArr[1], u_colorArr[2], remap( u_offset[1], u_offset[2], color.a ) );\n\t\t\t\t\t\t\t\t} else if (color.a <= u_offset[3]) {\n\t\t\t\t\t\t\t\t\tcolor_ = mix( u_colorArr[2], u_colorArr[3], remap( u_offset[2], u_offset[3], color.a ) );\n\t\t\t\t\t\t\t\t} else if (color.a <= u_offset[4]) {\n\t\t\t\t\t\t\t\t\tcolor_ = mix( u_colorArr[3], u_colorArr[4], remap( u_offset[3], u_offset[4], color.a ) );\n\t\t\t\t\t\t\t\t} else if (color.a <= u_offset[5]) {\n\t\t\t\t\t\t\t\t\tcolor_ = mix( u_colorArr[4], u_colorArr[5], remap( u_offset[4], u_offset[5], color.a ) );\n\t\t\t\t\t\t\t\t} else if (color.a <= u_offset[6]) {\n\t\t\t\t\t\t\t\t\tcolor_ = mix( u_colorArr[5], u_colorArr[6], remap( u_offset[5], u_offset[6], color.a ) );\n\t\t\t\t\t\t\t\t} else if (color.a <= u_offset[7]) {\n\t\t\t\t\t\t\t\t\tcolor_ = mix( u_colorArr[6], u_colorArr[7], remap( u_offset[6], u_offset[7], color.a ) );\n\t\t\t\t\t\t\t\t} else if (color.a <= u_offset[8]) {\n\t\t\t\t\t\t\t\t\tcolor_ = mix( u_colorArr[7], u_colorArr[8], remap( u_offset[7], u_offset[8], color.a ) );\n\t\t\t\t\t\t\t\t} else if (color.a <= u_offset[9]) {\n\t\t\t\t\t\t\t\t\tcolor_ = mix( u_colorArr[8], u_colorArr[9], remap( u_offset[8], u_offset[9], color.a ) );\n\t\t\t\t\t\t\t\t} else if (color.a <= u_offset[10]) {\n\t\t\t\t\t\t\t\t\tcolor_ = mix( u_colorArr[9], u_colorArr[10], remap( u_offset[9], u_offset[10], color.a ) );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcolor_.a = color.a - (1.0 - u_opacity);\n\t\t\t\t\t\t\t\tif (color_.a < 0.0) {\n\t\t\t\t\t\t\t\t\tcolor_.a = 0.0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tgl_FragColor = color_;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t",e="\n\t\t\t\t\t\tattribute vec2 a_texCoord;\n\t\t\t\t\t\tvarying vec2 v_texCoord;\n\t\t\t\t\t\tvoid main() {\n\t\t\t\t\t\t\tvec2 clipSpace = a_texCoord * 2.0 - 1.0;\n\t\t\t\t\t\t\tgl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\t\t\t\t\t\t\tv_texCoord = a_texCoord;\n\t\t\t\t\t\t}\n\t\t\t";return function(a,i={}){function n(t,o,r){var e=t.createShader(t[o]);if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS)){var a=t.getShaderInfoLog(e);console.error("*** Error compiling shader '"+e+"':"+a),t.deleteShader(e)}return e}var u,f,l=[];let s=[],c=0;function _(a,i){const u=document.querySelector(a),f=u.clientHeight,l=u.clientWidth,s=document.createElement("canvas"),c=s.getContext("webgl",{premultipliedAlpha:!1,depth:!1,antialias:!0,alpha:!0}),_=function(t){return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}(c);c.clearColor(0,0,0,0),c.enable(c.BLEND),c.blendEquation(c.FUNC_ADD),c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),c.depthMask(!0),s.setAttribute("height",f*_),s.setAttribute("width",l*_),s.style.height=`${f}px`,s.style.width=`${l}px`,s.style.position="absolute",u.appendChild(s),this.gradient=function(t){const o=[],r=t.length,e=[];return t.forEach((function(t){o.push(t.color[0]/255),o.push(t.color[1]/255),o.push(t.color[2]/255),o.push(void 0===t.color[3]?1:t.color[3]),e.push(t.offset)})),{value:new Float32Array(o),length:r,offset:e}}(i.gradient),this.ctx=c,this.width=l*_,this.height=f*_,this.layer=s,this.dom=u,this.gradShadOP=function(r){var e=n(r,"VERTEX_SHADER",o),a=n(r,"FRAGMENT_SHADER",t),i=r.createProgram();if(r.attachShader(i,e),r.attachShader(i,a),r.linkProgram(i),!r.getProgramParameter(i,r.LINK_STATUS)){var u=r.getProgramInfoLog(i);console.error("Error in program linking:"+u),r.deleteProgram(i)}return{program:i,attr:[{bufferType:r.ARRAY_BUFFER,buffer:r.createBuffer(),drawType:r.STATIC_DRAW,valueType:r.FLOAT,size:2,attribute:r.getAttribLocation(i,"a_position"),data:new Float32Array([])},{bufferType:r.ARRAY_BUFFER,buffer:r.createBuffer(),drawType:r.STATIC_DRAW,valueType:r.FLOAT,size:1,attribute:r.getAttribLocation(i,"a_intensity"),data:new Float32Array([])}],uniform:{u_resolution:r.getUniformLocation(i,"u_resolution"),u_max:r.getUniformLocation(i,"u_max"),u_size:r.getUniformLocation(i,"u_size"),u_blurr:r.getUniformLocation(i,"u_blurr"),u_translate:r.getUniformLocation(i,"u_translate"),u_zoom:r.getUniformLocation(i,"u_zoom"),u_angle:r.getUniformLocation(i,"u_angle"),u_density:r.getUniformLocation(i,"u_density")}}}(this.ctx),this.colorShadOP=function(t){var o=n(t,"VERTEX_SHADER",e),a=n(t,"FRAGMENT_SHADER",r),i=t.createProgram();if(t.attachShader(i,o),t.attachShader(i,a),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){var u=t.getProgramInfoLog(i);console.error("Error in program linking:"+u),t.deleteProgram(i)}return{program:i,attr:[{bufferType:t.ARRAY_BUFFER,buffer:t.createBuffer(),drawType:t.STATIC_DRAW,valueType:t.FLOAT,size:2,attribute:t.getAttribLocation(i,"a_texCoord"),data:new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])}],uniform:{u_framebuffer:t.getUniformLocation(i,"u_framebuffer"),u_colorArr:t.getUniformLocation(i,"u_colorArr"),u_colorCount:t.getUniformLocation(i,"u_colorCount"),u_opacity:t.getUniformLocation(i,"u_opacity"),u_offset:t.getUniformLocation(i,"u_offset")}}}(this.ctx),this.fbTexObj=c.createTexture(),this.fbo=c.createFramebuffer(),this.size=i.size?i.size:20,this.max=i.max,this.blurr=i.blurr?i.blurr:1,this.translate=i.translate&&2===i.translate.length?i.translate:[0,0],this.zoom=i.zoom?i.zoom:1,this.angle=i.rotationAngle?i.rotationAngle:0,this.opacity=i.opacity?i.opacity:1,this.ratio=_,c.viewport(0,0,c.canvas.width,c.canvas.height)}return _.prototype.resize=function(){},_.prototype.clear=function(){this.ctx.clear(this.ctx.COLOR_BUFFER_BIT|this.ctx.DEPTH_BUFFER_BIT)},_.prototype.setMax=function(t){this.max=t,this.render(this.exData)},_.prototype.setTranslate=function(t){this.translate=2===t.length?t:[0,0],this.render(this.exData)},_.prototype.setZoom=function(t){this.zoom=void 0!==t?t:1,this.render(this.exData)},_.prototype.setRotationAngle=function(t){this.angle=void 0!==t?t:0,this.render(this.exData)},_.prototype.setSize=function(t){this.size=void 0!==t?t:20,this.render(this.exData)},_.prototype.setBlurr=function(t){this.blurr=void 0!==t?t:1,this.render(this.exData)},_.prototype.setOpacity=function(t){this.opacity=void 0!==t?t:1,this.render(this.exData)},_.prototype.renderData=function(t){const o=function(t){const o=t.length;c!==o&&(u=new ArrayBuffer(8*o),l=new Float32Array(u),f=new ArrayBuffer(4*o),s=new Float32Array(f),c=o);for(let r=0;r<o;r++)l[2*r]=t[r].x,l[2*r+1]=t[r].y,s[r]=t[r].value;return{posVec:l,rVec:s}}(t);this.render(o)},_.prototype.render=function(t){const o=this.ctx;this.exData=t,this.gradShadOP.attr[0].data=t.posVec,this.gradShadOP.attr[1].data=t.rVec,o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.useProgram(this.gradShadOP.program),o.uniform2fv(this.gradShadOP.uniform.u_resolution,new Float32Array([this.width,this.height])),o.uniform2fv(this.gradShadOP.uniform.u_translate,new Float32Array([this.translate[0],this.translate[1]])),o.uniform1f(this.gradShadOP.uniform.u_zoom,this.zoom),o.uniform1f(this.gradShadOP.uniform.u_angle,this.angle),o.uniform1f(this.gradShadOP.uniform.u_density,this.ratio),o.uniform1f(this.gradShadOP.uniform.u_max,this.max),o.uniform1f(this.gradShadOP.uniform.u_size,this.size),o.uniform1f(this.gradShadOP.uniform.u_blurr,this.blurr),this.gradShadOP.attr.forEach((function(t){o.bindBuffer(t.bufferType,t.buffer),o.bufferData(t.bufferType,t.data,t.drawType),o.enableVertexAttribArray(t.attribute),o.vertexAttribPointer(t.attribute,t.size,t.valueType,!0,0,0)})),o.bindTexture(o.TEXTURE_2D,this.fbTexObj),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,this.width,this.height,0,o.RGBA,o.UNSIGNED_BYTE,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.bindFramebuffer(o.FRAMEBUFFER,this.fbo),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,this.fbTexObj,0),o.drawArrays(o.POINTS,0,t.posVec.length/2),o.bindFramebuffer(o.FRAMEBUFFER,null),o.useProgram(this.colorShadOP.program),o.uniform4fv(this.colorShadOP.uniform.u_colorArr,this.gradient.value),o.uniform1f(this.colorShadOP.uniform.u_colorCount,this.gradient.length),o.uniform1fv(this.colorShadOP.uniform.u_offset,new Float32Array(this.gradient.offset)),o.uniform1f(this.colorShadOP.uniform.u_opacity,this.opacity),this.colorShadOP.attr.forEach((function(t){o.bindBuffer(t.bufferType,t.buffer),o.bufferData(t.bufferType,t.data,t.drawType),o.enableVertexAttribArray(t.attribute),o.vertexAttribPointer(t.attribute,t.size,t.valueType,!0,0,0)})),o.uniform1i(this.colorShadOP.uniform.u_framebuffer,0),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.fbTexObj),o.drawArrays(o.TRIANGLES,0,6)},new _(a,i)}}));
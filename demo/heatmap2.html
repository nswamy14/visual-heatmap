<!DOCTYPE html>
<html style="height: 100%">

<head>
    <title></title>
</head>
<body style="height: 100%">

<div id="canvas" style="height: 100%;width:100%;background: #000;">
    <img src="world_map_PNG14.png" alt="Smiley face" style="position: absolute; width: 100%; height: 100%">
</div>
<script type="text/javascript" src="./dat.gui.min.js"></script>

<script type="module">

import Heatmap from '/main.js'

let data = [];
let instance = Heatmap('#canvas', {
        size: 50.0,
        max: 100,
        gradient: [{
            color: [0, 0, 255, 1.0],
            offset: 0.0
        }, {
            color: [0, 0, 255, 1.0],
            offset: 0.35
        }, {
            color: [255, 0, 0, 1.0],
            offset: 0.75
        }, {
            color: [255, 255, 255, 1.0],
            offset: 1.0
        }]
    });

    var gui = new dat.GUI();
    var Params = function() {
        this.points = 10000;
        this.pointSize = 30;
        this.opacity = 1.0;
        this.blurr = 1.0;
        this.transalteX = 0;
        this.transalteY = 0;
        this.zoom = 1.0;
        this.rotationAngle = 0.0;
        this.update = function() {
        }
    };

    var params = new Params();
    gui.add( params, 'points', 1, 1000000 ).onChange( function () {
        data = generateData(params.points);
        instance.renderData(data);
    } );
	gui.add( params, 'pointSize', 1, 100 ).onChange( function () {
        instance.setSize(params.pointSize);
    } );
    gui.add( params, 'opacity', 0, 1 ).onChange( function () {
        instance.setOpacity(params.opacity);
    } );
    gui.add( params, 'blurr', 0, 1 ).onChange( function () {
        instance.setBlurr(params.blurr);
    } );
    gui.add( params, 'transalteX', -instance.width, instance.width ).onChange( function () {
        instance.setTranslate([params.transalteX, params.transalteY]);
    } );
    gui.add( params, 'transalteY', -instance.height, instance.height ).onChange( function () {
        instance.setTranslate([params.transalteX, params.transalteY]);
    } );
    gui.add( params, 'zoom', 0, 50 ).onChange( function () {
        instance.setZoom(params.zoom);
    } );
    gui.add( params, 'rotationAngle', 0, Math.PI * 2 ).onChange( function () {
        instance.setRotationAngle(params.rotationAngle);
    } );


    function generateData (count) {
        var data = [];
        for (let i = 0; i < count; i++) {
            let val = Math.random() * 100
            data.push({
                x: Math.random() * instance.width,
                y: Math.random() * instance.height,
                velX: random(-0.5, 0.25),
                velY: random(-0.5, 0.25),
                value: val
            });
        }
        return data;
    }
    data = generateData(1000);
    call();

    function call () {
        updateData();
        instance.renderData(data);
        window.requestAnimationFrame(call);
    }
    
    function updateData() {
        let circle;
        for (let i = 0, len = data.length; i < len; i++) {
            circle = data[i];
            
            if ((circle.x + circle.value) >= instance.width) {
                circle.velX = -(circle.velX);
            }
            if ((circle.x - circle.value) <= 0) {
                circle.velX = -(circle.velX);
            }
            if ((circle.y + circle.value) >= instance.height) {
                circle.velY = -(circle.velY);
            }
            if ((circle.y - circle.value) <= 0) {
                circle.velY = -(circle.velY);
            }

            // if (((circle.x + circle.value) >= 1400) || ((circle.x - circle.value) <= 0)) {
            //     circle.velX = -(circle.velX);
            // }

            // if (((circle.y + circle.value) >= 900) || ((circle.y - circle.value) <= 0)) {
            //     circle.velY = -(circle.velY);
            // }

            circle.x += circle.velX;
            circle.y += circle.velY;
        }
    }
    
    function random(min, max) {
        var num = (Math.random() * (max - min)) + min;
        return num;
    }
</script>

</body>

</html>